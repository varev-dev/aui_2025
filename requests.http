@gatewayUrl = http://localhost:8080/api
@clusterId = REPLACE_WITH_ACTUAL_CLUSTER_ID
@nodeId = REPLACE_WITH_ACTUAL_NODE_ID

### CLUSTER OPERATIONS (via Gateway -> Cluster Service :8081)

### 1. Get all clusters
GET {{gatewayUrl}}/clusters
Accept: application/json

###

### 2. Get single cluster
GET {{gatewayUrl}}/clusters/{{clusterId}}
Accept: application/json

###

### 3. Create new cluster (will trigger event to Node Service)
POST {{gatewayUrl}}/clusters
Content-Type: application/json

{
  "name": "Gateway Test Cluster",
  "location": "Test Data Center via Gateway"
}

###

### 4. Update cluster (will trigger event to Node Service)
PUT {{gatewayUrl}}/clusters/{{clusterId}}
Content-Type: application/json

{
  "name": "Updated via Gateway",
  "location": "Updated Location via Gateway"
}

###

### 5. Delete cluster (will trigger event to Node Service - cascades nodes)
DELETE {{gatewayUrl}}/clusters/{{clusterId}}

###

########################################
### NODE OPERATIONS - All Nodes (via Gateway -> Node Service :8082)
########################################

### 6. Get all nodes
GET {{gatewayUrl}}/nodes
Accept: application/json

###

### 7. Get single node
GET {{gatewayUrl}}/nodes/{{nodeId}}
Accept: application/json

###

### 8. Delete node by ID
DELETE {{gatewayUrl}}/nodes/{{nodeId}}

###

########################################
### NODE OPERATIONS - By Cluster (via Gateway -> Node Service :8082)
########################################

### 9. Get all nodes from cluster
GET {{gatewayUrl}}/clusters/{{clusterId}}/nodes
Accept: application/json

###

### 10. Get specific node from cluster
GET {{gatewayUrl}}/clusters/{{clusterId}}/nodes/{{nodeId}}
Accept: application/json

###

### 11. Create node in cluster
POST {{gatewayUrl}}/clusters/{{clusterId}}/nodes
Content-Type: application/json

{
  "hostname": "gateway-test-node.local",
  "gpuLoad": 65.5,
  "temperature": 72
}

###

### 12. Update node
PUT {{gatewayUrl}}/clusters/{{clusterId}}/nodes/{{nodeId}}
Content-Type: application/json

{
  "hostname": "updated-via-gateway.local",
  "gpuLoad": 88.0,
  "temperature": 85
}

###

### 13. Delete node from cluster
DELETE {{gatewayUrl}}/clusters/{{clusterId}}/nodes/{{nodeId}}

###

########################################
### COMPLETE WORKFLOW - Event Communication Test
########################################

### Step 1: Create cluster in Cluster Service
# @name createCluster
POST {{gatewayUrl}}/clusters
Content-Type: application/json

{
  "name": "Event Test Cluster",
  "location": "Event Communication Test"
}

###

### Step 2: Verify cluster exists in Cluster Service
GET {{gatewayUrl}}/clusters
Accept: application/json

###

### Step 3: Check if cluster reference was created in Node Service (empty nodes)
GET {{gatewayUrl}}/clusters/PASTE_CLUSTER_ID_HERE/nodes
Accept: application/json

###

### Step 4: Add nodes to the cluster
POST {{gatewayUrl}}/clusters/PASTE_CLUSTER_ID_HERE/nodes
Content-Type: application/json

{
  "hostname": "event-test-node-01.local",
  "gpuLoad": 50.0,
  "temperature": 65
}

###

POST {{gatewayUrl}}/clusters/PASTE_CLUSTER_ID_HERE/nodes
Content-Type: application/json

{
  "hostname": "event-test-node-02.local",
  "gpuLoad": 75.0,
  "temperature": 78
}

###

### Step 5: Verify nodes were created
GET {{gatewayUrl}}/clusters/PASTE_CLUSTER_ID_HERE/nodes
Accept: application/json

###

### Step 6: Update cluster (tests CLUSTER_UPDATED event)
PUT {{gatewayUrl}}/clusters/PASTE_CLUSTER_ID_HERE
Content-Type: application/json

{
  "name": "Event Test Cluster UPDATED",
  "location": "Updated Location"
}

###

### Step 7: Verify cluster reference was updated in Node Service
GET {{gatewayUrl}}/nodes
Accept: application/json

###

### Step 8: Delete cluster (tests CLUSTER_DELETED event - cascades to nodes)
DELETE {{gatewayUrl}}/clusters/PASTE_CLUSTER_ID_HERE

###

### Step 9: Verify all nodes were deleted from Node Service
GET {{gatewayUrl}}/nodes
Accept: application/json

###

########################################
### DIRECT SERVICE ACCESS (for debugging)
########################################

### Access Cluster Service directly (bypass gateway)
GET http://localhost:8081/api/clusters
Accept: application/json

###

### Access Node Service directly (bypass gateway)
GET http://localhost:8082/api/nodes
Accept: application/json

###

### Check H2 Console - Cluster Service
# http://localhost:8081/h2-console
# JDBC URL: jdbc:h2:mem:clusterdb

###

### Check H2 Console - Node Service
# http://localhost:8082/h2-console
# JDBC URL: jdbc:h2:mem:nodedb

########################################
### TESTING EVENT COMMUNICATION
########################################

### Scenario: Create cluster and verify event propagation
# 1. Create cluster via Cluster Service
POST http://localhost:8081/api/clusters
Content-Type: application/json

{
  "name": "Direct Event Test",
  "location": "Direct Call"
}

###

# 2. Check logs in Node Service - should show event received
# 3. Check if cluster reference exists in Node Service
GET http://localhost:8082/api/clusters/PASTE_CLUSTER_ID_HERE/nodes
Accept: application/json

###

### Scenario: Delete cluster and verify cascade delete
# 1. Create cluster with nodes first
# 2. Delete cluster via Cluster Service
DELETE http://localhost:8081/api/clusters/PASTE_CLUSTER_ID_HERE

###

# 3. Verify nodes were deleted in Node Service
GET http://localhost:8082/api/nodes
Accept: application/json

###